# 縦断駅伝選手名簿管理システム（Flask版）仕様書 ver1.0

## 1. システム概要

### 1.1 目的

駅伝チームの選手情報、記録を一元管理し、区間オーダーのシミュレーションをスマホ・PCから行うWebアプリケーション。

### 1.2 コンセプト

- **最短構成**: Python (Flask) のみで構築し、複雑な通信を排除。
- **データ連携**: Googleスプレッドシートをデータベースとして直接読み書きする。
- **スマホ対応**: 現場（グラウンドや合宿所）でスマホから閲覧・入力できるレスポンシブデザイン。

---

## 2. システム構成（アーキテクチャ）

```mermaid
graph LR
    User[ユーザー (スマホ/PC)] -- HTTPS --> CloudRun[Google Cloud Run (Python Flask)]
    CloudRun -- API --> Sheets[Googleスプレッドシート (DB)]
```

### 2.1 技術スタック

| カテゴリ | 技術 | 選定理由 |
|---------|------|----------|
| 言語 | Python 3.9+ | 扱いやすく、ライブラリが豊富。 |
| フレームワーク | Flask | 軽量で、小規模アプリに最適。 |
| HTML/CSS | Jinja2 + Bootstrap 5 | スマホ対応デザインを簡単に作るため (CDN利用)。 |
| データベース | Google Sheets | データの閲覧・修正がスプレッドシート上でも可能。 |
| DB操作 | gspread | Pythonからスプレッドシートを操作するライブラリ。 |
| インフラ | Google Cloud Run | サーバー管理不要でコンテナを動かす。 |

---

## 3. 画面・機能一覧

ページ数を減らし、直感的な導線にします。

| 画面名 | URL例 | 機能説明 |
|--------|-------|----------|
| 1. 選手一覧 (ホーム) | `/` | 選手をカード形式で一覧表示。検索・絞り込み機能。 |
| 2. 選手詳細 & 記録 | `/player/<id>` | プロフィール表示、過去の記録グラフ表示。 |
| 3. 記録登録 | `/record/add` | 選手を選んでタイムを入力するフォーム。 |
| 4. シミュレーション | `/simulation` | ドラッグ＆ドロップで区間配置を検討・保存。 |
| (管理機能) | - | 選手の追加・編集機能（簡易的なBasic認証等で保護）。 |

---

## 4. データベース設計（スプレッドシート）

スプレッドシートには以下の3つのシート（タブ）を作成します。

### シート1: Players (選手マスタ)

| 列 | 項目名 | 説明 |
|----|--------|------|
| A | id | 一意のID (UUID推奨だが、単純な番号でも可) |
| B | name | 氏名 |
| C | group | 所属 (Aチーム / Bチーム / 中学生 等) |
| D | best_5000m | 5000mの自己ベスト (自動計算または手動) |
| E | target_time | 今シーズンの目標タイム |
| F | active | 有効フラグ (TRUE/FALSE) - 引退した選手を隠す用 |

### シート2: Records (記録データ)

| 列 | 項目名 | 説明 |
|----|--------|------|
| A | date | 日付 (YYYY/MM/DD) |
| B | player_id | 選手ID (PlayersシートのA列と紐付け) |
| C | event | 種目 (3000m, 5000m, 1区, etc.) |
| D | time | タイム (MM:SS または HH:MM:SS) |
| E | memo | メモ (コンディション、天候など) |

### シート3: Simulations (区間オーダー案)

| 列 | 項目名 | 説明 |
|----|--------|------|
| A | created_at | 作成日時 |
| B | title | シミュレーション名 (例: 「県大会想定オーダー」) |
| C | order_data | JSON形式で保存 (例: `{"1区": "田中", "2区": "佐藤"...}`) |

---

## 5. ディレクトリ構成（開発するファイル）

最小限のファイル構成です。これだけあれば動きます。

```
ekiden-app/
├── main.py              # アプリ本体 (ルーティング、ロジック)
├── requirements.txt     # 必要なライブラリ一覧
├── Dockerfile           # Cloud Run用の設定
├── services/
│   └── sheet_api.py     # スプレッドシート読み書き処理を分離
├── templates/           # HTMLファイル置き場
│   ├── base.html        # 共通レイアウト (ヘッダー、メニュー)
│   ├── index.html       # 選手一覧画面
│   ├── detail.html      # 詳細画面
│   └── simulation.html  # シミュレーション画面
└── static/              # CSSや画像 (必要であれば)
```

---

## 6. 開発ロードマップ

この仕様書に基づき、以下の順序で作るのが最も効率的です。

| ステップ | 内容 | 状態 |
|----------|------|------|
| 1 | **環境構築**: Hello World の表示。 | ✅ 完了済 |
| 2 | **DB接続**: Pythonからスプレッドシートのデータを読み込んで、画面に「文字」として表示する。 | |
| 3 | **一覧画面作成**: Bootstrapを入れて、選手データを綺麗な「カード」として表示する。 | |
| 4 | **詳細画面作成**: 選手をクリックしたら、その人の記録が表示されるようにする。 | |
| 5 | **登録機能**: 画面上のフォームから、スプレッドシートに新しい行を追加できるようにする。 | |
| 6 | **シミュレーション機能**: JavaScriptを使ってドラッグ＆ドロップでオーダーを組めるようにする。 | |
