{% extends "base.html" %}

{% block title %}„É¨„Éº„Çπ‰∏ÄË¶ß - ÂçóÈôΩÊù±ÁΩÆË≥ú{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }
    .page-header h5 {
        margin: 0;
        font-size: 18px;
        color: var(--text-color);
    }
    .race-card {
        display: block;
        padding: 14px 16px;
        border-bottom: 1px solid var(--border-color);
        text-decoration: none;
        color: inherit;
    }
    .race-card:last-child {
        border-bottom: none;
    }
    .race-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 6px;
    }
    .race-name {
        font-weight: 600;
        font-size: 15px;
        color: var(--text-color);
    }
    .race-badges {
        display: flex;
        gap: 4px;
        flex-shrink: 0;
    }
    .type-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
    }
    .type-badge.ekiden {
        background: #ED8936;
        color: white;
    }
    .type-badge.track {
        background: #3182CE;
        color: white;
    }
    .type-badge.road {
        background: #38A169;
        color: white;
    }
    .race-meta {
        display: flex;
        gap: 12px;
        font-size: 12px;
        color: var(--text-muted);
        margin-bottom: 8px;
    }
    .race-meta i {
        margin-right: 4px;
    }
    .race-players {
        font-size: 11px;
        color: var(--text-muted);
        line-height: 1.5;
    }
    .race-players-label {
        font-weight: 600;
        margin-right: 4px;
    }
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-muted);
    }
    .empty-state i {
        font-size: 48px;
        margin-bottom: 12px;
        display: block;
    }
    .race-count {
        font-size: 11px;
        color: var(--text-muted);
        margin-left: 8px;
    }

    /* „Çø„Ç§„ÉóÂà•„Éï„Ç£„É´„Çø„Éº */
    .filter-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        overflow-x: auto;
        padding-bottom: 4px;
    }
    .filter-tab {
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 12px;
        font-weight: 600;
        background: var(--bg-color);
        color: var(--text-muted);
        border: none;
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s;
    }
    .filter-tab:hover {
        background: var(--border-color);
    }
    .filter-tab.active {
        background: #3182ce;
        color: white;
    }
    .filter-tab .count {
        margin-left: 4px;
        opacity: 0.8;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h5><i class="bi bi-trophy-fill text-warning"></i> „É¨„Éº„Çπ‰∏ÄË¶ß</h5>
    <span class="race-count">{{ races|length }}‰ª∂</span>
</div>

<!-- „Éï„Ç£„É´„Çø„Éº„Çø„Éñ -->
<div class="filter-tabs">
    <button class="filter-tab active" data-filter="all">
        „Åô„Åπ„Å¶<span class="count">({{ races|length }})</span>
    </button>
    <button class="filter-tab" data-filter="ÈßÖ‰ºù">
        üèÉ ÈßÖ‰ºù<span class="count">({{ races|selectattr('race_type', 'equalto', 'ÈßÖ‰ºù')|list|length }})</span>
    </button>
    <button class="filter-tab" data-filter="„Éà„É©„ÉÉ„ÇØ">
        üèüÔ∏è „Éà„É©„ÉÉ„ÇØ<span class="count">({{ races|selectattr('race_type', 'equalto', '„Éà„É©„ÉÉ„ÇØ')|list|length }})</span>
    </button>
    <button class="filter-tab" data-filter="„É≠„Éº„Éâ">
        üõ£Ô∏è „É≠„Éº„Éâ<span class="count">({{ races|selectattr('race_type', 'equalto', '„É≠„Éº„Éâ')|list|length }})</span>
    </button>
</div>

<div class="card">
    {% for race in races %}
    <div class="race-card" data-type="{{ race.race_type }}">
        <div class="race-header">
            <div class="race-name">{{ race.race_name }}</div>
            <div class="race-badges">
                {% if race.race_type == 'ÈßÖ‰ºù' %}
                <span class="type-badge ekiden">ÈßÖ‰ºù</span>
                {% elif race.race_type == '„Éà„É©„ÉÉ„ÇØ' %}
                <span class="type-badge track">„Éà„É©„ÉÉ„ÇØ</span>
                {% elif race.race_type == '„É≠„Éº„Éâ' %}
                <span class="type-badge road">„É≠„Éº„Éâ</span>
                {% elif race.race_type %}
                <span class="type-badge" style="background: #718096; color: white;">{{ race.race_type }}</span>
                {% endif %}
            </div>
        </div>
        <div class="race-meta">
            <span><i class="bi bi-calendar3"></i>{{ race.date }}</span>
            <span><i class="bi bi-people"></i>{{ race.player_count }}ÂêçÂá∫Â†¥</span>
            <span><i class="bi bi-list-ol"></i>{{ race.record_count }}‰ª∂</span>
        </div>
        {% if race.player_names %}
        <div class="race-players">
            <span class="race-players-label">Âá∫Â†¥:</span>
            {{ race.player_names|join(', ') }}
        </div>
        {% endif %}
    </div>
    {% else %}
    <div class="empty-state">
        <i class="bi bi-trophy"></i>
        <p class="mb-0">„É¨„Éº„ÇπË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
        <p class="text-muted mt-2" style="font-size: 13px;">ÈÅ∏Êâã„ÅÆË®òÈå≤„ÇíËøΩÂä†„Åô„Çã„Å®„ÄÅ„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</p>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// „Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ
document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const filter = this.dataset.filter;

        // „Çø„Éñ„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÇíÂàá„ÇäÊõø„Åà
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        // „Ç´„Éº„Éâ„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
        document.querySelectorAll('.race-card').forEach(card => {
            if (filter === 'all' || card.dataset.type === filter) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}
