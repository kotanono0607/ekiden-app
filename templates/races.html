{% extends "base.html" %}

{% block title %}レース一覧 - 南陽東置賜{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }
    .page-header h5 {
        margin: 0;
        font-size: 18px;
        color: var(--text-color);
    }
    .race-card {
        display: block;
        padding: 14px 16px;
        border-bottom: 1px solid var(--border-color);
        text-decoration: none;
        color: inherit;
    }
    .race-card:last-child {
        border-bottom: none;
    }
    .race-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 6px;
    }
    .race-name {
        font-weight: 600;
        font-size: 15px;
        color: var(--text-color);
    }
    .race-badges {
        display: flex;
        gap: 4px;
        flex-shrink: 0;
    }
    .type-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 10px;
        font-weight: 600;
    }
    .type-badge.ekiden {
        background: #ED8936;
        color: white;
    }
    .type-badge.track {
        background: #3182CE;
        color: white;
    }
    .type-badge.road {
        background: #38A169;
        color: white;
    }
    .race-meta {
        display: flex;
        gap: 12px;
        font-size: 12px;
        color: var(--text-muted);
        margin-bottom: 8px;
    }
    .race-meta i {
        margin-right: 4px;
    }
    .race-players {
        font-size: 11px;
        color: var(--text-muted);
        line-height: 1.5;
    }
    .race-players-label {
        font-weight: 600;
        margin-right: 4px;
    }
    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--text-muted);
    }
    .empty-state i {
        font-size: 48px;
        margin-bottom: 12px;
        display: block;
    }
    .race-count {
        font-size: 11px;
        color: var(--text-muted);
        margin-left: 8px;
    }

    /* タイプ別フィルター */
    .filter-tabs {
        display: flex;
        gap: 6px;
        margin-bottom: 16px;
        overflow-x: auto;
        padding-bottom: 4px;
    }
    .filter-tab {
        padding: 6px 10px;
        border-radius: 16px;
        font-size: 12px;
        font-weight: 600;
        background: var(--bg-color);
        color: var(--text-muted);
        border: none;
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s;
    }
    .filter-tab:hover {
        background: var(--border-color);
    }
    .filter-tab.active {
        background: #3182ce;
        color: white;
    }
    .filter-tab .count {
        margin-left: 4px;
        opacity: 0.8;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h5><i class="bi bi-trophy-fill text-warning"></i> レース一覧</h5>
    <span class="race-count">{{ races|length }}件</span>
</div>

<!-- フィルタータブ -->
<div class="filter-tabs">
    <button class="filter-tab active" data-filter="all">
        すべて<span class="count">({{ races|length }})</span>
    </button>
    <button class="filter-tab" data-filter="駅伝">
        駅伝<span class="count">({{ races|selectattr('race_type', 'equalto', '駅伝')|list|length }})</span>
    </button>
    <button class="filter-tab" data-filter="トラック">
        トラック<span class="count">({{ races|selectattr('race_type', 'equalto', 'トラック')|list|length }})</span>
    </button>
    <button class="filter-tab" data-filter="ロード">
        ロード<span class="count">({{ races|selectattr('race_type', 'equalto', 'ロード')|list|length }})</span>
    </button>
</div>

<div class="card">
    {% for race in races %}
    <a href="/race/detail/{{ race.race_name|urlencode }}" class="race-card" data-type="{{ race.race_type }}">
        <div class="race-header">
            <div class="race-name">{{ race.race_name }}</div>
            <div class="race-badges">
                {% if race.race_type == '駅伝' %}
                <span class="type-badge ekiden">駅伝</span>
                {% elif race.race_type == 'トラック' %}
                <span class="type-badge track">トラック</span>
                {% elif race.race_type == 'ロード' %}
                <span class="type-badge road">ロード</span>
                {% elif race.race_type %}
                <span class="type-badge" style="background: #718096; color: white;">{{ race.race_type }}</span>
                {% endif %}
                <i class="bi bi-chevron-right" style="color: var(--text-muted); margin-left: 4px;"></i>
            </div>
        </div>
        <div class="race-meta">
            <span><i class="bi bi-calendar3"></i>{{ race.date }}</span>
            <span><i class="bi bi-people"></i>{{ race.player_count }}名出場</span>
            <span><i class="bi bi-list-ol"></i>{{ race.record_count }}件</span>
        </div>
        {% if race.player_names %}
        <div class="race-players">
            <span class="race-players-label">出場:</span>
            {{ race.player_names|join(', ') }}
        </div>
        {% endif %}
    </a>
    {% else %}
    <div class="empty-state">
        <i class="bi bi-trophy"></i>
        <p class="mb-0">レース記録がありません</p>
        <p class="text-muted mt-2" style="font-size: 13px;">選手の記録を追加すると、ここに表示されます</p>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// フィルター機能
document.querySelectorAll('.filter-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const filter = this.dataset.filter;

        // タブのアクティブ状態を切り替え
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        // カードのフィルタリング
        document.querySelectorAll('.race-card').forEach(card => {
            if (filter === 'all' || card.dataset.type === filter) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });
});
</script>
{% endblock %}
